// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              Int      @id @default(autoincrement())
  nome            String   @db.VarChar(100)
  email           String   @unique @db.VarChar(100)
  senha           String   @db.VarChar(255)
  matricula       String?  @unique @db.VarChar(50)
  tipo            String   @default("aluno") @db.VarChar(20)
  foto_perfil_url String?  @db.VarChar(255)
  data_cadastro   DateTime @default(now()) @db.Timestamptz(6)
  itens_encontrados Item[] @relation("UsuarioEncontrou")
  itens_retirados   Item[] @relation("UsuarioRetirou")
}

model Item {
  id                  Int       @id @default(autoincrement())
  id_usuario_encontrou Int
  nome_item           String    @db.VarChar(100)
  descricao           String?   @db.Text
  local_encontrado    String?   @db.VarChar(255)
  data_encontrado     DateTime? @db.Date
  turno_encontrado    String?   @db.VarChar(50)
  categoria           String?   @db.VarChar(100)
  foto_item_url       String?   @db.VarChar(255)
  status              String    @default("achado") @db.VarChar(50)
  data_cadastro_item  DateTime  @default(now()) @db.Timestamptz(6)
  
  id_usuario_retirou  Int?
  nome_pessoa_retirou String?   @db.VarChar(100)
  matricula_recebedor String?   @db.VarChar(50)
  data_entrega        DateTime? @db.Timestamptz(6)
  
  local_retirada      String?   @default("Guarita") @db.VarChar(255)
  data_limite_retirada DateTime? @db.Date

  usuario_encontrou   Usuario   @relation("UsuarioEncontrou", fields: [id_usuario_encontrou], references: [id])
  usuario_retirou     Usuario?  @relation("UsuarioRetirou", fields: [id_usuario_retirou], references: [id])
}

model Session {
  sid     String   @id @db.VarChar
  sess    Json
  expire  DateTime @db.Timestamp(6)

  @@index([expire], name: "IDX_session_expire")
}
